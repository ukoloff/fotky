{
  "version": 3,
  "file": "generated.js",
  "sources": [
    "W:\\Work\\js\\fotky\\node_modules\\browser-pack\\_prelude.js",
    "W:/Work/js/fotky/node_modules/without/without.js",
    "W:/Work/js/fotky/src/history.coffee",
    "W:/Work/js/fotky/src/jsonp.coffee",
    "W:/Work/js/fotky/src/main.coffee",
    "W:/Work/js/fotky/src/merge.coffee",
    "W:/Work/js/fotky/src/picture.coffee",
    "W:/Work/js/fotky/src/root.coffee",
    "W:/Work/js/fotky/src/router.coffee",
    "W:/Work/js/fotky/src/thumbs.coffee",
    "W:/Work/js/fotky/src/yalbum.coffee",
    "W:/Work/js/fotky/src/ymg.coffee",
    "W:/Work/js/fotky/src/yuser.coffee"
  ],
  "names": [],
  "mappings": "AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7RA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA",
  "sourcesContent": [
    "(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",
    "//\r\n// without.js - CoffeScript template engine with lexical scoping\r\n//\r\n\r\n(function()\r\n{\r\n  var\r\n    nTags='a abbr acronym address applet article aside audio b bdo big blockquote body button \\\r\ncanvas caption center cite code colgroup command datalist dd del details dfn dir div dl dt \\\r\nem embed fieldset figcaption figure font footer form frameset h1 h2 h3 h4 h5 h6 head header hgroup html \\\r\ni iframe ins keygen kbd label legend li map mark menu meter nav noframes noscript object \\\r\nol optgroup option output p pre progress q rp rt ruby \\\r\ns samp script section select small source span strike strong style sub summary sup \\\r\ntable tbody td textarea tfoot th thead time title tr tt u ul video wbr xmp'.split(' '),\r\n    eTags='area base basefont br col frame hr img input link meta param'.split(' '),\r\n    htmlEntities={'&': '&amp;', '<': '&lt;', '>': '&gt;', '\"': '&quot;'},\r\n    slice=[].slice,\r\n    scope={},\r\n    names=0,\r\n    html='',\r\n    _this\r\n\r\n  function h(s)\r\n  {\r\n    return String(s).replace(/[&<>\"]/g, function(e){return htmlEntities[e]})\r\n  }\r\n\r\n  function children(a)\r\n  {\r\n    var i, e\r\n    for(i=0; i<a.length; i++)\r\n    {\r\n      if(null==(e=a[i])) continue;\r\n      if('function'==typeof e)\r\n        e.call(_this)\r\n      else\r\n        html+=h(e)\r\n    }\r\n  }\r\n\r\n  function print(a)\r\n  {\r\n    var i, e\r\n    for(i=0; i<a.length; i++) if(null!=(e=a[i])) html+=h(e)\r\n  }\r\n\r\n  function raw(a)\r\n  {\r\n    var i, e\r\n    for(i=0; i<a.length; i++) if(null!=(e=a[i])) html+=e\r\n  }\r\n\r\n  function makeTag(name, empty)\r\n  {\r\n    return function(){tag(arguments)}\r\n    function attr(k, v)\r\n    {\r\n      if(null==v || false===v) return\r\n      html+=' '+h(k)\r\n      if(true!==v) html+='=\"'+h(v)+'\"'\r\n    }\r\n    function nest(prefix, obj)\r\n    {\r\n      for(var k in obj)\r\n        if('object'==typeof obj[k])\r\n          nest(prefix+k+'-', obj[k])\r\n        else\r\n          attr(prefix+k, obj[k])\r\n    }\r\n    function tag(a)\r\n    {\r\n      html+='<'+name\r\n      var at=a[0]\r\n      if('object'==typeof at)\r\n      {\r\n       for(var k in at)\r\n         if('data'==k && 'object'==typeof at[k])\r\n           nest('data-', at[k])\r\n         else\r\n           attr(k, at[k])\r\n       a=slice.call(a, 1)\r\n      }\r\n      html+='>'\r\n      if(empty && a.length) throw new SyntaxError(\"<\"+name+\"> must have no content!\")\r\n      if(empty) return\r\n      children(a)\r\n      html+=\"</\"+name+\">\"\r\n    }\r\n  }\r\n\r\n  function makeComment()\r\n  {\r\n    var level=0;\r\n    return function(){ comment.apply(this, arguments) }\r\n    function comment()\r\n    {\r\n      html+= level++? '<comment level=\"'+level+'\">' : \"<!-- \"\r\n      children(arguments)\r\n      html+= --level? '</comment>': ' -->'\r\n    }\r\n  }\r\n\r\n  function coffeeScript()\r\n  {\r\n    if(1!=arguments.length ||'function'!=typeof arguments[0])\r\n      throw new SyntaxError('Usage: coffeescript -> code')\r\n    html+='<script><!--\\n('+arguments[0].toString()+')()\\n//-->\\n</script>';\r\n  }\r\n\r\n  function adhocTag()\r\n  {\r\n    return function(name, empty){ return tag(name, empty) }\r\n    function isEmpty(name)\r\n    {\r\n      for(var i in eTags) if(name==eTags[i]) return true\r\n    }\r\n    function tag(name, empty)\r\n    {\r\n      return makeTag(name, null==empty? isEmpty(String(name).toLowerCase()) : empty)\r\n    }\r\n  }\r\n\r\n  function noTag(attrs)\r\n  {\r\n    children('object'==typeof attrs ? slice.call(arguments, 1) : arguments)\r\n  }\r\n\r\n  scope.print=scope.text=function(){print(arguments)}\r\n  scope.raw=function(){raw(arguments)}\r\n  scope.tag=adhocTag()\r\n  scope.notag=function(){noTag.apply(this, arguments)}\r\n  scope.comment=makeComment()\r\n  scope.blackhole=function(){}\r\n  scope.coffeescript=function(){ coffeeScript.apply(this, arguments) }\r\n\r\n  for(var i in nTags) scope[nTags[i]]=makeTag(nTags[i])\r\n  scope.$var=makeTag('var')\r\n  for(var i in eTags) scope[eTags[i]]=makeTag(eTags[i], true)\r\n\r\n  function makeVars()\r\n  {\r\n    var v=[];\r\n    for(var tag in scope) v.push(tag+'=this.'+tag)\r\n    return 'var '+v.join(',')\r\n  }\r\n\r\n  function renderable(fn, wrapper, n)\r\n  {\r\n    if('function'!=typeof fn)\r\n      throw new TypeError(\"Call: withOut.compile(function)\")\r\n    var pending=true, minified\r\n    wrapper.id=null\r\n    return render\r\n\r\n    function render()\r\n    {\r\n      if(pending) build()\r\n      try\r\n      {\r\n        var that=_this, x=html\r\n        _this=this\r\n        html=''\r\n        if(bp())\r\n          debugger // Hit `Step Into` (F11) twice\r\n        fn.apply(this, arguments)\r\n        return html\r\n      }\r\n      finally\r\n      {\r\n        _this=that\r\n        html=x\r\n      }\r\n    }\r\n\r\n    function getName()\r\n    {\r\n      var name = wrapper.id\r\n      if(null==name) name=''\r\n      name=String(name).split(/\\W+/).join('/').replace(/^\\/+|\\/+$/g, '')\r\n      if(!name.length)name=++names\r\n      wrapper.id=name\r\n      if(n)\r\n        name+='['+n+']'\r\n      return name\r\n    }\r\n\r\n    function build()\r\n    {\r\n      var name\r\n      fn=fn.toString()\r\n      minified = !/[\\r\\n]/.test(fn)\r\n      fn=makeVars()+'\\nreturn '+fn\r\n      if(!minified)\r\n        fn+='\\n//# sourceURL=eval://withOut/'+(name=getName())+'.wo'\r\n      fn=(new Function(fn)).call(scope)\r\n      if(!minified)\r\n      {\r\n        fn.displayName='<'+name+'>'\r\n        wrapper.displayName='{{'+name+'}}'\r\n      }\r\n    }\r\n\r\n    function bp()\r\n    {\r\n      if(minified || false===lib.bp) return\r\n      if(lib.bp) return true\r\n      if(n && 'number'==typeof wrapper.bp)\r\n        return n==wrapper.bp\r\n      return wrapper.bp\r\n    }\r\n  }\r\n\r\n  function compile(fn)\r\n  {\r\n    var withOut=renderable(fn, wrapper)\r\n    return wrapper\r\n\r\n    function wrapper(){return withOut.apply(this, arguments)}\r\n  }\r\n\r\n  function $compile(fn)\r\n  {\r\n    var withOut=renderable(fn, wrapper)\r\n    return wrapper\r\n\r\n    function wrapper(that){return withOut.apply(that, arguments)}\r\n  }\r\n\r\n  function flatten(array)\r\n  {\r\n    var v, r=[]\r\n    for(var i in array)\r\n      if('object'==typeof(v=array[i]))\r\n        r.push.apply(r, flatten(v))\r\n      else\r\n        r.push(v)\r\n    return r\r\n  }\r\n\r\n  function JSTs(path)\r\n  {\r\n    var bound, Ts=flatten(slice.call(arguments))\r\n    wrapper.id=null\r\n    return wrapper\r\n\r\n    function wrapper(that){return JSTs.apply(that, arguments)}\r\n\r\n    function JSTs()\r\n    {\r\n      var S=''\r\n      if(!bound) fetchJSTs()\r\n      for(var i in Ts) S+=Ts[i].apply(this, arguments)\r\n      return S\r\n    }\r\n\r\n    function fetchJSTs()\r\n    {\r\n      var v, id=wrapper.id\r\n      for(var i in Ts)\r\n      {\r\n        if('function'!=typeof(v=Ts[i]) &&\r\n           'function'!=typeof(v=JST[v]))\r\n          throw new Error(\"JST['\"+Ts[i]+\"'] not found or incorrect!\")\r\n        Ts[i]=renderable(v, wrapper, Number(i)+1)\r\n      }\r\n      wrapper.id=id\r\n      bound=true\r\n    }\r\n  }\r\n\r\n  var lib={\r\n    compile: compile,\r\n    renderable: compile,\r\n    $compile: $compile,\r\n    JSTs: JSTs\r\n  }\r\n  if('undefined'!=typeof module && module.exports)\r\n    module.exports=lib\r\n  else if('function'==typeof define && define.amd)\r\n    define(lib)\r\n  else\r\n    this.withOut=lib\r\n})()\r\n\r\n//--[EOF]------------------------------------------------------------\r\n",
    "var startHistory;\n\nstartHistory = function(fn) {\n  var checkHash, prev;\n  prev = null;\n  checkHash = function() {\n    var hash;\n    hash = /#(.*)|$/.exec(location.href)[1] || '';\n    if (prev === hash) {\n      return;\n    }\n    prev = hash;\n    return typeof fn === \"function\" ? fn(hash) : void 0;\n  };\n  if ('onhashchange' in window) {\n    window.onhashchange = checkHash;\n  } else {\n    window.setInterval(checkHash, 50);\n  }\n  return checkHash();\n};\n\nmodule.exports = startHistory;\n",
    "var jsonp, merge, quote, random;\n\nmerge = require(1);\n\nquote = encodeURIComponent;\n\njsonp = function(options) {\n  var Clear, Error, callback, cbname, data, h, js, k, q, timeout, url, v, _ref;\n  _ref = merge(jsonp.defaults, options), url = _ref.url, callback = _ref.callback, timeout = _ref.timeout;\n  while (window[cbname = \"_\" + (random(15))]) {}\n  data = merge(options.data);\n  data[callback] = cbname;\n  q = '';\n  for (k in data) {\n    v = data[k];\n    if ((v != null) && (v = String(v)).length) {\n      q += \"\" + (q.length || 0 <= url.indexOf('?') ? '&' : '?') + (quote(k)) + \"=\" + (quote(v));\n    }\n  }\n  window[cbname] = function(data) {\n    Clear();\n    return typeof options.success === \"function\" ? options.success(data) : void 0;\n  };\n  Error = function() {\n    Clear();\n    return typeof options.error === \"function\" ? options.error() : void 0;\n  };\n  js = document.createElement('script');\n  js.onerror = Error;\n  js.src = url + q;\n  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(js);\n  h = setTimeout(Error, timeout);\n  Clear = function() {\n    try {\n      delete window[cbname];\n    } catch (_error) {\n      window[cbname] = null;\n    }\n    clearTimeout(h);\n    js.onerror = null;\n    js.parentNode.removeChild(js);\n    return js = null;\n  };\n};\n\njsonp.defaults = {\n  callback: 'callback',\n  timeout: 3000\n};\n\nrandom = function(q) {\n  var n, s;\n  if (q == null) {\n    q = 1;\n  }\n  s = '';\n  while (s.length < q) {\n    n = Math.floor(62 * Math.random());\n    s += String.fromCharCode(n % 26 + 'Aa0'.charCodeAt(n / 26));\n  }\n  return s;\n};\n\nmodule.exports = jsonp;\n",
    "var Yuser, root, route;\n\nYuser = require(3);\n\nroot = require(1);\n\nroute = require(2);\n\nroot.register(Yuser);\n\nroot.ready = route;\n",
    "var merge;\n\nmerge = function() {\n  var k, r, v, x, _i, _len;\n  r = {};\n  for (_i = 0, _len = arguments.length; _i < _len; _i++) {\n    x = arguments[_i];\n    if (x != null) {\n      for (k in x) {\n        v = x[k];\n        r[k] = v;\n      }\n    }\n  }\n  return r;\n};\n\nmodule.exports = merge;\n",
    "var picture, root, t, tF, tH, withOut;\n\nroot = require(1);\n\nwithOut = require(2);\n\npicture = function(img, album) {\n  var find, z;\n  find = function() {\n    var i, z, _i, _len, _ref;\n    _ref = album.ymgs;\n    for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {\n      z = _ref[i];\n      if (!(z.id === img)) {\n        continue;\n      }\n      z.idx = Number(i);\n      return z;\n    }\n  };\n  if (album.failed || !(z = find())) {\n    location.hash = '#' + album.fullPath();\n    return;\n  }\n  document.title = z.def.title;\n  root.head.innerHTML = tH(z, album);\n  root.body.innerHTML = '';\n  root.foot.innerHTML = tF(z.def.summary);\n  return root.body.innerHTML = t(z, root.size());\n};\n\nt = withOut.$compile(function(z, size) {\n  var f0, factor, k, thumb, x, _ref;\n  if (size.w < 1) {\n    size.w = 1;\n  }\n  if (size.h < 1) {\n    size.h = 1;\n  }\n  thumb = null;\n  _ref = z.def.img;\n  for (k in _ref) {\n    x = _ref[k];\n    factor = Math.abs(Math.log(x.width * size.h > x.height * size.w ? x.width / size.w : x.height / size.h));\n    if (!thumb || factor < f0) {\n      thumb = x;\n      f0 = factor;\n    }\n  }\n  return img({\n    src: thumb.href,\n    alt: z.def.title,\n    title: z.def.title,\n    style: \"max-height: \" + size.h + \"px; max-width: \" + size.w + \"px;\"\n  });\n});\n\nt.id = 'img';\n\ntH = withOut.$compile(function(img, album) {\n  a({\n    \"class\": 'left',\n    href: '#' + (album.ymgs[img.idx - 1] || album).fullPath(),\n    title: 'Назад'\n  }, '<<');\n  a({\n    href: '#'\n  }, 'Галереи');\n  text(' / ');\n  a({\n    href: '#' + album.fullPath()\n  }, album.def.title);\n  text(' / ');\n  b(img.def.title);\n  return a({\n    \"class\": 'right',\n    href: '#' + (album.ymgs[img.idx + 1] || album).fullPath(),\n    title: 'Вперёд'\n  }, '>>');\n});\n\ntH.id = 'iHead';\n\ntF = withOut.$compile(function(txt) {\n  return i(txt);\n});\n\ntF.id = 'iFoot';\n\nmodule.exports = picture;\n",
    "var domains, el, flatten, getUsers, indexUser, load, loaders, merge, parse, regions, size, withOut;\n\nmerge = require(1);\n\nwithOut = require(2);\n\nloaders = [];\n\ndomains = {};\n\nel = null;\n\nsetTimeout(function() {\n  var script;\n  if (!(el = document.getElementById('fotky'))) {\n    return;\n  }\n  if (!(script = el.getElementsByTagName('script')[0])) {\n    return;\n  }\n  return load(parse(script.innerHTML));\n});\n\nflatten = function(array) {\n  var r, x, _;\n  r = [];\n  for (_ in array) {\n    x = array[_];\n    if ('object' === typeof x) {\n      r.push.apply(r, flatten(x));\n    } else {\n      r.push(x);\n    }\n  }\n  return r;\n};\n\nexports.register = function() {\n  var i, x, z, _i, _j, _len, _len1, _ref, _ref1;\n  _ref = loaders = flatten([].slice.call(arguments));\n  for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {\n    z = _ref[i];\n    _ref1 = z.exts || [];\n    for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {\n      x = _ref1[_j];\n      domains[x] = i;\n    }\n  }\n};\n\nparse = function(ids) {\n  var m, re, stars, user, _results;\n  re = /[*]|(?:([-\\w]+)(?:@([-\\w]+(?:[.][-\\w]+)?))?)/g;\n  _results = [];\n  while (m = re.exec(ids)) {\n    if (m[2]) {\n      user = {\n        u: m[1],\n        d: domains[m[2]]\n      };\n      if (user.d == null) {\n        user = null;\n      }\n      stars = 0;\n      continue;\n    }\n    if (!user) {\n      continue;\n    }\n    if ('*' === m[0]) {\n      if (stars++) {\n        continue;\n      }\n    }\n    _results.push(merge({\n      id: m[0]\n    }, user, stars & 1 && '*' !== m[0] ? {\n      off: 1\n    } : {}));\n  }\n  return _results;\n};\n\ngetUsers = function(ids, fn) {\n  var getUser, list, users, z, _, _i, _len, _name;\n  users = {};\n  for (_i = 0, _len = ids.length; _i < _len; _i++) {\n    z = ids[_i];\n    users[_name = z.uid = \"\" + z.u + \"@\" + z.d] || (users[_name] = z);\n  }\n  list = (function() {\n    var _results;\n    _results = [];\n    for (_ in users) {\n      z = users[_];\n      _results.push(z);\n    }\n    return _results;\n  })();\n  users = {};\n  return (getUser = function() {\n    if (!(z = list.pop())) {\n      return typeof fn === \"function\" ? fn(users) : void 0;\n    }\n    return new loaders[z.d](z.u, {\n      error: getUser,\n      success: function() {\n        indexUser(users[z.uid] = this);\n        return getUser();\n      }\n    });\n  })();\n};\n\nindexUser = function(u) {\n  var z, _i, _len, _ref, _results;\n  if (u._) {\n    return;\n  }\n  u._ = {};\n  _ref = u.yalbums;\n  _results = [];\n  for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n    z = _ref[_i];\n    if (z.visible()) {\n      _results.push(u._[z.id] = z);\n    }\n  }\n  return _results;\n};\n\nregions = function() {\n  var x, _i, _len, _ref;\n  el.innerHTML = withOut.compile(function() {\n    var i, _i, _len, _ref;\n    _ref = 'head body foot'.split(' ');\n    for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n      i = _ref[_i];\n      div({\n        id: i\n      });\n    }\n  })();\n  _ref = el.childNodes;\n  for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n    x = _ref[_i];\n    exports[x.id] = x;\n  }\n};\n\nload = function(ids) {\n  return getUsers(ids, function(users) {\n    var addAlbum, addAll, delAlbum, list, u, x, z, _i, _len;\n    list = [];\n    addAlbum = function(a) {\n      if (a.idx != null) {\n        return;\n      }\n      return a.idx = -1 + list.push(a);\n    };\n    addAll = function(u) {\n      var k, v, _ref, _results;\n      _ref = u._;\n      _results = [];\n      for (k in _ref) {\n        v = _ref[k];\n        _results.push(addAlbum(v));\n      }\n      return _results;\n    };\n    delAlbum = function(a) {\n      var i, z, _i, _len;\n      if (a.idx == null) {\n        return;\n      }\n      list.splice(a.idx, 1);\n      for (i = _i = 0, _len = list.length; _i < _len; i = ++_i) {\n        z = list[i];\n        z.idx = i;\n      }\n      return delete a.idx;\n    };\n    for (_i = 0, _len = ids.length; _i < _len; _i++) {\n      z = ids[_i];\n      if (!(u = users[z.uid])) {\n        continue;\n      }\n      if ('*' === z.id) {\n        addAll(u);\n        continue;\n      }\n      if (!(x = u._[z.id])) {\n        continue;\n      }\n      if (z.off) {\n        delAlbum(x);\n      } else {\n        addAlbum(x);\n      }\n    }\n    regions();\n    return typeof exports.ready === \"function\" ? exports.ready(list) : void 0;\n  });\n};\n\nsize = function() {\n  return {\n    w: el.offsetWidth,\n    h: document.body.clientHeight - exports.head.offsetHeight - exports.foot.offsetHeight\n  };\n};\n\nexports.size = size;\n",
    "var history, picture, root, routing, tF, tH, tOops, tWait, thumbs, withOut;\n\nhistory = require(1);\n\nroot = require(2);\n\nthumbs = require(3);\n\npicture = require(4);\n\nwithOut = require(5);\n\nrouting = function(albums) {\n  var all, title, z, _i, _len;\n  title = document.title;\n  all = {};\n  for (_i = 0, _len = albums.length; _i < _len; _i++) {\n    z = albums[_i];\n    all[z.fullPath()] = z;\n  }\n  return history(function(hash) {\n    var a, fire, img;\n    if ('' === hash) {\n      document.title = title;\n      root.head.innerHTML = '';\n      root.foot.innerHTML = '';\n      thumbs(albums);\n      return;\n    }\n    hash = hash.split(/\\/+/);\n    if (!(a = all[hash.slice(0, 2).join('/')])) {\n      location.hash = '#';\n      return;\n    }\n    document.title = a.def.title;\n    root.head.innerHTML = tH(a);\n    root.foot.innerHTML = tF(a.def.summary);\n    img = hash.slice(2).join('/');\n    fire = function(oops) {\n      a.loaded = true;\n      if (oops) {\n        a.failed = true;\n      }\n      if (img) {\n        return picture(img, a);\n      } else if (a.failed) {\n        return root.body.innerHTML = tOops;\n      } else {\n        return thumbs(a.ymgs);\n      }\n    };\n    if (a.loaded) {\n      return fire();\n    } else {\n      root.body.innerHTML = tWait();\n      return a.loadPhotos({\n        success: fire,\n        error: function() {\n          return fire(1);\n        }\n      });\n    }\n  });\n};\n\ntH = withOut.$compile(function(album) {\n  a({\n    href: '#'\n  }, 'Галереи');\n  text(' / ');\n  return b(album.def.title);\n});\n\ntH.id = 'aHead';\n\ntF = withOut.$compile(function(txt) {\n  return i(txt);\n});\n\ntF.id = 'aFoot';\n\ntWait = withOut.compile(function() {\n  return div({\n    \"class\": 'info'\n  }, 'Идёт загрузка альбома...');\n});\n\ntWait.id = 'wait';\n\ntOops = withOut.compile(function() {\n  return div({\n    \"class\": 'error'\n  }, 'Не удалось загрузить альбом :-(');\n})();\n\nmodule.exports = routing;\n",
    "var root, t, thumbs, withOut;\n\nroot = require(1);\n\nwithOut = require(2);\n\nthumbs = function(list) {\n  var w;\n  w = root.size();\n  return root.body.innerHTML = t(list, w.w / Math.max(3, Math.sqrt(list.length)));\n};\n\nt = withOut.$compile(function(list, size) {\n  var k, thumb, v, w0, w1, y, _i, _len, _ref;\n  for (_i = 0, _len = list.length; _i < _len; _i++) {\n    y = list[_i];\n    thumb = 0;\n    _ref = y.def.img;\n    for (k in _ref) {\n      v = _ref[k];\n      w1 = Math.max(v.width, v.height);\n      if (!thumb || (w0 < w1 && w1 <= size) || (w0 > w1 && w1 >= size) || (w1 <= size && size < w0)) {\n        thumb = v;\n        w0 = w1;\n      }\n    }\n    span({\n      \"class\": 'thumbnail'\n    }, function() {\n      return a({\n        style: \"width: \" + thumb.width + \"px;\",\n        href: \"#\" + (y.fullPath()),\n        title: y.def.title || null\n      }, function() {\n        img({\n          src: thumb.href,\n          alt: y.def.title\n        });\n        div(function() {\n          return b(y.def.title);\n        });\n        return div({\n          title: y.def.summary || null\n        }, function() {\n          return small(y.def.summary);\n        });\n      });\n    });\n  }\n});\n\nt.id = 'thumbs';\n\nmodule.exports = thumbs;\n",
    "var Yalbum, Ymg, jsonp;\n\nYmg = require(1);\n\njsonp = require(2);\n\nYalbum = function(yuser, def) {\n  this.def = def;\n  this.id = def.id.split(':').reverse()[0];\n  return this.path = yuser.id;\n};\n\nYalbum.prototype = {\n  loadPhotos: function(options) {\n    if (!this.visible()) {\n      return;\n    }\n    return jsonp({\n      url: this.def.links.photos,\n      success: (function(_this) {\n        return function(data) {\n          var y, _ref;\n          _this.ymgs = (function() {\n            var _i, _len, _ref, _results;\n            _ref = (this.photos = data).entries;\n            _results = [];\n            for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n              y = _ref[_i];\n              _results.push(new Ymg(this, y));\n            }\n            return _results;\n          }).call(_this);\n          return (_ref = options.success) != null ? _ref.call(_this) : void 0;\n        };\n      })(this),\n      error: (function(_this) {\n        return function() {\n          var _ref;\n          return (_ref = options.error) != null ? _ref.call(_this) : void 0;\n        };\n      })(this)\n    });\n  },\n  fullPath: function() {\n    return \"\" + this.path + \"/\" + this.id;\n  },\n  visible: function() {\n    return this.def.img != null;\n  }\n};\n\nmodule.exports = Yalbum;\n",
    "var Ymg;\n\nYmg = function(yalbum, def) {\n  this.def = def;\n  this.id = def.id.split(':').reverse()[0];\n  return this.path = yalbum.fullPath();\n};\n\nYmg.prototype = {\n  fullPath: function() {\n    return \"\" + this.path + \"/\" + this.id;\n  }\n};\n\nmodule.exports = Ymg;\n",
    "var Yalbum, Yuser, jsonp;\n\nYalbum = require(1);\n\njsonp = require(2);\n\nYuser = function(name, options) {\n  var findId, makeYalbums;\n  this.name = name;\n  jsonp({\n    url: \"http://api-fotki.yandex.ru/api/users/\" + (escape(name)) + \"/\",\n    data: {\n      format: 'json'\n    },\n    error: (function(_this) {\n      return function() {\n        var _ref;\n        return (_ref = options.error) != null ? _ref.call(_this) : void 0;\n      };\n    })(this),\n    success: (function(_this) {\n      return function(data) {\n        _this.service = data;\n        return jsonp({\n          url: data.collections['album-list'].href + '?format=json',\n          error: function() {\n            var _ref;\n            return (_ref = options.error) != null ? _ref.call(_this) : void 0;\n          },\n          success: function(data) {\n            var _ref;\n            _this.albums = data;\n            findId();\n            _this.yalbums = makeYalbums();\n            return (_ref = options.success) != null ? _ref.call(_this) : void 0;\n          }\n        });\n      };\n    })(this)\n  });\n  findId = (function(_this) {\n    return function() {\n      var a, _i, _len, _ref;\n      _ref = _this.albums.authors;\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        a = _ref[_i];\n        if (a.name === _this.name) {\n          return _this.id = a.uid;\n        }\n      }\n    };\n  })(this);\n  return makeYalbums = (function(_this) {\n    return function() {\n      var a, _i, _len, _ref, _results;\n      _ref = _this.albums.entries;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        a = _ref[_i];\n        _results.push(new Yalbum(_this, a));\n      }\n      return _results;\n    };\n  })(this);\n};\n\nYuser.exts = 'y yandex ya.ru yandex.ru'.split(' ');\n\nmodule.exports = Yuser;\n"
  ],
  "sourceRoot": ""
}